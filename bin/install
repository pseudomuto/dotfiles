#!/bin/bash
set -euo pipefail
source "${BASH_SOURCE[0]%/*}/../lib/util.sh"

# common path updates
PATH="/usr/local/go/bin:${PATH}"

# placeholder (optional method for tasks)
valid_options() { return; }

main_usage() {
  echo "$0 <task> [task_args]" "" $RED
  exit 1
}

main() {
  local original_args="$@"
  local package="${0%/*}/../lib/tasks/${1}"

  shift
  source "${package}"
  source $(build_options)

  if ! valid_options; then
    error "ERROR: Invalid options passed: ${original_args}"
    usage && exit 1
  fi

  if met; then condition_already_met; fi

  meet

  if ! met; then error "ERROR: condition was not met after executing this task."; exit 1; fi
}

if [[ "$#" -lt 1 ]]; then
  main_usage
else
  main "$@"
fi
